<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Simulasi Filtrasi Redoks - Kearifan Lokal</title>
    <style>
        :root {
            --bg-primary: #f0f9ff;
            --bg-secondary: #e0f2fe;
            --accent: #0284c7;
            --accent-dark: #0c4a6e;
            --success: #10b981;
            --warning: #f59e0b;
            --muted: #64748b;
            --card-bg: #ffffff;
            --border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            font-family: 'Segoe UI', system-ui, -apple-system, Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #1e293b;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            max-width: 1200px;
            width: 100%;
        }

        .header h1 {
            font-size: 28px;
            color: var(--accent-dark);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .header p {
            font-size: 14px;
            color: var(--muted);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }

            .panel-right {
                order: -1;
            }
        }

        /* Scene Panel */
        .scene {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            min-height: 500px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
        }

        .scene-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lab-area {
            flex: 1;
            display: flex;
            gap: 24px;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
            position: relative;
            z-index: 2;
        }

        .water-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .glass {
            width: 100px;
            height: 160px;
            border-radius: 8px;
            border: 3px solid #475569;
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 12px 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .glass-label {
            font-size: 11px;
            font-weight: 700;
            color: #334155;
            margin-bottom: 8px;
            z-index: 2;
        }

        .water {
            width: 100%;
            flex: 1;
            border-radius: 4px;
            background: rgba(120, 72, 0, 0.7);
            transition: background 900ms ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .glass-hint {
            font-size: 12px;
            color: var(--muted);
            text-align: center;
            max-width: 120px;
        }

        #airBersih_hasil.clean .water {
            background: linear-gradient(180deg, rgba(96, 165, 250, 0.3) 0%, rgba(147, 197, 253, 0.5) 100%);
        }

        /* Filtration Bottle */
        #botolFiltrasi {
            width: 200px;
            height: 380px;
            border: 4px solid #78350f;
            border-radius: 12px;
            position: relative;
            background: linear-gradient(180deg, #ffffff 0%, #fef3c7 100%);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            padding: 16px 12px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        #botolFiltrasi:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        #botolFiltrasi.over {
            border-color: var(--accent);
            background: linear-gradient(180deg, #e0f2fe 0%, #fef3c7 100%);
        }

        .bottle-label {
            font-weight: 700;
            color: #78350f;
            font-size: 13px;
            text-align: center;
            margin-bottom: 12px;
        }

        .layer-list {
            flex: 1;
            display: flex;
            flex-direction: column-reverse;
            gap: 8px;
            overflow: auto;
            padding: 4px;
        }

        .layer {
            min-height: 50px;
            border-radius: 8px;
            border: 2px dashed rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: #1e293b;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .layer:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: #ef4444;
        }

        .drop-hint {
            font-size: 11px;
            color: #92400e;
            text-align: center;
            margin-top: 8px;
            opacity: 0.7;
        }

        .pouring {
            position: absolute;
            left: 50%;
            top: 60px;
            transform: translateX(-50%);
            width: 20px;
            height: 150px;
            pointer-events: none;
            display: none;
            z-index: 10;
        }

        .stream {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(139, 90, 43, 0.8), rgba(107, 63, 32, 0.6));
            border-radius: 10px;
            animation: drop 1600ms ease-out forwards;
        }

        @keyframes drop {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            80% {
                transform: translateY(250px);
                opacity: 0.8;
            }

            100% {
                transform: translateY(300px);
                opacity: 0;
            }
        }

        .river {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            height: 25%;
            background: linear-gradient(180deg, #bae6fd 0%, #7dd3fc 100%);
            border-top-left-radius: 50% 30%;
            border-top-right-radius: 50% 30%;
            opacity: 0.6;
            z-index: 1;
        }

        /* Right Panel */
        .panel-right {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .panel-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .inventory {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .item {
            height: 80px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
            font-weight: 600;
            font-size: 13px;
            padding: 8px;
            text-align: center;
            cursor: grab;
            transition: all 0.2s ease;
            line-height: 1.3;
            touch-action: none;
            will-change: transform;
        }

        .item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-color: var(--accent);
        }

        .item:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        .item small {
            display: block;
            font-size: 10px;
            color: var(--muted);
            font-weight: 500;
            margin-top: 4px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(2, 132, 199, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 10px 15px -3px rgba(2, 132, 199, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.4);
        }

        .btn-outline {
            background: white;
            color: var(--accent-dark);
            border: 2px solid var(--border);
        }

        .btn-outline:hover {
            border-color: var(--accent);
            background: var(--bg-primary);
        }

        .hint-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #92400e;
            margin-top: 12px;
        }

        .hint-box strong {
            display: block;
            margin-bottom: 4px;
            color: #78350f;
        }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 100;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
        }

        .modal-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            max-width: 600px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-card h3 {
            color: var(--accent-dark);
            margin-bottom: 16px;
            font-size: 20px;
        }

        .modal-card p {
            font-size: 14px;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        footer {
            max-width: 1200px;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: var(--muted);
            padding: 16px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            backdrop-filter: blur(8px);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .inventory {
                grid-template-columns: 1fr;
            }

            .lab-area {
                flex-direction: column;
                gap: 16px;
            }

            #botolFiltrasi {
                width: 180px;
                height: 320px;
            }

            .header h1 {
                font-size: 22px;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üî¨ Simulasi Filtrasi Lokal & Reaksi Redoks</h1>
        <p>Pelajari proses penjernihan air menggunakan bahan-bahan lokal</p>
    </div>

    <div class="container">
        <div class="scene panel">
            <div class="scene-title">‚öóÔ∏è Area Eksperimen</div>

            <div class="lab-area">
                <div class="water-container">
                    <div id="airKotor" class="glass" title="Air Kotor">
                        <div class="glass-label">üíß AIR KOTOR</div>
                        <div class="water"></div>
                    </div>
                    <div class="glass-hint">Sumber air mentah</div>
                </div>

                <div style="position: relative;">
                    <div id="botolFiltrasi" aria-label="Botol Filtrasi">
                        <div class="bottle-label">üß™ BOTOL FILTRASI</div>
                        <div class="layer-list" id="layerList"></div>
                        <div class="drop-hint">(Tarik bahan ke sini)</div>
                        <div class="pouring" id="pouring">
                            <div class="stream"></div>
                        </div>
                    </div>
                </div>

                <div class="water-container">
                    <div id="airBersih_hasil" class="glass" title="Hasil" aria-live="polite">
                        <div class="glass-label">‚ú® AIR HASIL</div>
                        <div class="water"></div>
                    </div>
                    <div class="glass-hint">Hasil filtrasi</div>
                </div>
            </div>

            <div class="river"></div>
        </div>

        <aside class="panel-right">
            <div class="panel">
                <div class="panel-title">üì¶ Inventaris Bahan Lokal</div>
                <div class="inventory" id="inventory">
                    <div class="item" id="kerikil" draggable="true" data-type="kerikil">
                        ü™® Kerikil
                        <small>pelindung</small>
                    </div>
                    <div class="item" id="pasir" draggable="true" data-type="pasir">
                        üèñÔ∏è Pasir
                        <small>penjerap</small>
                    </div>
                    <div class="item" id="arang_aktif" draggable="true" data-type="arang_aktif">
                        ‚ö´ Arang Aktif
                        <small>adsorben/redoks</small>
                    </div>
                    <div class="item" id="ijuk" draggable="true" data-type="ijuk">
                        üåæ Ijuk/Kasa
                        <small>filtrasi fisik</small>
                    </div>
                    <div class="item" id="tawas" draggable="true" data-type="tawas">
                        üíé Tawas
                        <small>koagulan</small>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="tombolMulaiFilter">
                        üöÄ Mulai Filtrasi
                    </button>
                    <button class="btn btn-secondary" id="showPenjelasan">
                        üìñ Penjelasan Redoks
                    </button>
                    <button class="btn btn-outline" id="reset">
                        üîÑ Reset Simulasi
                    </button>
                </div>

                <div class="hint-box">
                    <strong>üí° Tips Urutan Ideal:</strong>
                    Kerikil ‚Üí Pasir ‚Üí Arang Aktif ‚Üí Ijuk ‚Üí Tawas
                </div>
            </div>
        </aside>
    </div>

    <footer>
        üìù <strong>Catatan:</strong> Simulasi ini menjelaskan konsep sederhana. Arang aktif berfungsi sebagai adsorben
        yang juga dapat terlibat dalam proses redoks untuk mengubah/mengikat kontaminan.
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-card">
            <h3>Peran Arang Aktif & Redoks</h3>
            <p>Arang aktif bekerja terutama dengan <strong>adsorpsi</strong> (mengikat molekul pencemar pada
                permukaannya). Selain itu, banyak senyawa organik / logam terikat dapat mengalami perubahan kimia
                (oksidasi atau reduksi) ketika berinteraksi dengan permukaan aktif atau bersama koagulan seperti tawas.
                Dalam praktik lokal, penggunaan arang + pasir + kerikil menggabungkan proses fisika (penyaringan) dan
                kimia (pengendapan, koagulasi, adsorpsi, serta reaksi redoks kecil) untuk menjernihkan air. Jika arang
                aktif tidak ada, banyak kontaminan larut yang menyebabkan air tetap keruh atau berbau.</p>
            <div class="modal-actions">
                <button class="btn btn-outline" id="closeModal">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const layerList = document.getElementById('layerList');
            const inventory = document.getElementById('inventory');
            const items = Array.from(inventory.querySelectorAll('.item'));
            const correctOrder = ['kerikil', 'pasir', 'arang_aktif', 'ijuk', 'tawas'];
            let chosenOrder = [];

            function addLayer(type, label) {
                const el = document.createElement('div');
                el.className = 'layer';
                el.dataset.type = type;
                el.textContent = label;
                el.title = 'Klik untuk menghapus layer ini';
                layerList.appendChild(el);
            }

            const botol = document.getElementById('botolFiltrasi');

            // Make items draggable
            items.forEach(it => {
                makeDraggable(it);
            });

            function makeDraggable(domNode) {
                let ghost = null;
                let dragging = false;

                function start(ev) {
                    ev.preventDefault();
                    ev.stopPropagation();
                    dragging = true;

                    const clientX = ev.clientX !== undefined ? ev.clientX : ev.touches?.[0]?.clientX;
                    const clientY = ev.clientY !== undefined ? ev.clientY : ev.touches?.[0]?.clientY;

                    ghost = domNode.cloneNode(true);
                    ghost.style.position = 'fixed';
                    ghost.style.left = clientX + 'px';
                    ghost.style.top = clientY + 'px';
                    ghost.style.width = Math.max(80, domNode.offsetWidth) + 'px';
                    ghost.style.pointerEvents = 'none';
                    ghost.style.zIndex = '10000';
                    ghost.style.transform = 'translate(-50%, -50%)';
                    ghost.style.opacity = '0.9';
                    ghost.style.boxShadow = '0 10px 30px rgba(0,0,0,0.3)';
                    document.body.appendChild(ghost);

                    document.addEventListener('pointermove', move, { passive: false });
                    document.addEventListener('pointerup', end);
                    document.addEventListener('touchmove', move, { passive: false });
                    document.addEventListener('touchend', end);
                }

                function move(ev) {
                    if (!dragging || !ghost) return;
                    ev.preventDefault();

                    const clientX = ev.clientX !== undefined ? ev.clientX : ev.touches?.[0]?.clientX;
                    const clientY = ev.clientY !== undefined ? ev.clientY : ev.touches?.[0]?.clientY;

                    if (!clientX || !clientY) return;

                    ghost.style.left = clientX + 'px';
                    ghost.style.top = clientY + 'px';

                    // Collision check
                    const ghostRect = ghost.getBoundingClientRect();
                    const ghostCenterX = ghostRect.left + ghostRect.width / 2;
                    const ghostCenterY = ghostRect.top + ghostRect.height / 2;

                    const botolRect = botol.getBoundingClientRect();
                    const isOver = ghostCenterX >= botolRect.left &&
                        ghostCenterX <= botolRect.right &&
                        ghostCenterY >= botolRect.top &&
                        ghostCenterY <= botolRect.bottom;

                    if (isOver) {
                        botol.classList.add('over');
                        ghost.style.transform = 'translate(-50%, -50%) scale(1.12)';
                    } else {
                        botol.classList.remove('over');
                        ghost.style.transform = 'translate(-50%, -50%)';
                    }
                }

                function end(ev) {
                    if (!dragging) return;
                    dragging = false;

                    document.removeEventListener('pointermove', move);
                    document.removeEventListener('pointerup', end);
                    document.removeEventListener('touchmove', move);
                    document.removeEventListener('touchend', end);

                    if (ghost) {
                        const ghostRect = ghost.getBoundingClientRect();
                        const ghostCenterX = ghostRect.left + ghostRect.width / 2;
                        const ghostCenterY = ghostRect.top + ghostRect.height / 2;

                        const botolRect = botol.getBoundingClientRect();
                        const isOver = ghostCenterX >= botolRect.left &&
                            ghostCenterX <= botolRect.right &&
                            ghostCenterY >= botolRect.top &&
                            ghostCenterY <= botolRect.bottom;

                        if (isOver) {
                            const type = domNode.dataset.type;
                            const label = domNode.textContent.trim();
                            addToBottle(type, label);
                        }

                        botol.classList.remove('over');
                        ghost.remove();
                        ghost = null;
                    }
                }

                domNode.addEventListener('pointerdown', start);
                domNode.addEventListener('touchstart', start, { passive: false });
            }

            function addToBottle(type, label) {
                chosenOrder.push(type);
                addLayer(type, label);
            }

            // Start filtrasi
            const btn = document.getElementById('tombolMulaiFilter');
            const pouring = document.getElementById('pouring');
            const airKotor = document.querySelector('#airKotor .water');
            const airHasil = document.getElementById('airBersih_hasil');

            btn.addEventListener('click', () => {
                if (chosenOrder.length === 0) {
                    showSimpleModal('‚ö†Ô∏è Perhatian', 'Masukkan minimal satu bahan ke dalam botol untuk memulai filtrasi.');
                    return;
                }

                pouring.style.display = 'block';

                setTimeout(() => {
                    const hasArang = chosenOrder.includes('arang_aktif');
                    const orderMatch = arraysStartWith(chosenOrder, correctOrder) && chosenOrder.length === correctOrder.length;
                    const isGood = hasArang && orderMatch;

                    setTimeout(() => {
                        pouring.style.display = 'none';
                        if (isGood) {
                            airHasil.classList.add('clean');
                            airKotor.style.background = 'linear-gradient(180deg, rgba(96, 165, 250, 0.3), rgba(147, 197, 253, 0.5))';
                            showResult(true);
                        } else {
                            airHasil.classList.remove('clean');
                            showResult(false);
                        }
                    }, 1500);
                }, 80);
            });

            function arraysStartWith(a, b) {
                if (a.length !== b.length) return false;
                for (let i = 0; i < b.length; i++) if (a[i] !== b[i]) return false;
                return true;
            }

            function showResult(ok) {
                const title = ok ? '‚úÖ Berhasil: Air menjadi lebih jernih' : '‚ö†Ô∏è Hasil terbatas: Air masih keruh';
                const para = ok
                    ? 'Urutan dan bahan lengkap terpasang dengan benar! Arang aktif membantu adsorpsi kontaminan dan koagulan (tawas) membantu pengendapan partikel halus. Air hasil filtrasi tampak lebih jernih.'
                    : 'Urutan salah atau bahan penting (seperti arang aktif) tidak ada. Beberapa kontaminan larut masih tersisa sehingga air tetap keruh. Coba urutkan ulang sesuai tips yang diberikan.';
                showSimpleModal(title, para);
            }

            // Modal helpers
            const globalModal = document.getElementById('modal');

            document.getElementById('showPenjelasan').addEventListener('click', () => {
                globalModal.classList.add('active');
            });

            document.getElementById('closeModal').addEventListener('click', () => {
                globalModal.classList.remove('active');
            });

            globalModal.addEventListener('click', (e) => {
                if (e.target === globalModal) globalModal.classList.remove('active');
            });

            function showSimpleModal(title, text) {
                const card = globalModal.querySelector('.modal-card');
                card.querySelector('h3').textContent = title;
                card.querySelector('p').textContent = text;
                globalModal.classList.add('active');
            }

            // Reset
            document.getElementById('reset').addEventListener('click', () => {
                chosenOrder = [];
                layerList.innerHTML = '';
                document.querySelector('#airBersih_hasil .water').style.background = 'rgba(120,72,0,0.7)';
                document.getElementById('airBersih_hasil').classList.remove('clean');
                document.querySelector('#airKotor .water').style.background = 'rgba(120,72,0,0.7)';
            });

            // Remove layer by clicking
            layerList.addEventListener('click', e => {
                const l = e.target.closest('.layer');
                if (!l) return;
                const idx = Array.from(layerList.children).indexOf(l);
                if (idx > -1) {
                    chosenOrder.splice(idx, 1);
                    l.remove();
                }
            });

        })();
    </script>
</body>

</html>