<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Praktikum Redoks - EduLab</title>

    <!-- Fonts & shared stylesheet to match asam-basa -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="./assets/images/Logo.png" type="image/x-icon">

    <link rel="manifest" href="/edulab/manifest.json">
    <meta name="theme-color" content="#000000">
    <!-- iOS specific tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Edulab">
    <link rel="apple-touch-icon" href="/assets/images/Logo.png">

    <style>
        :root {
            --primary-purple: #667eea;
            --secondary-purple: #764ba2;
            --accent-blue: #1565c0;
            --text-dark: #2c3e50;
            --text-muted: #666;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(102, 126, 234, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-dark);
            overflow-x: hidden;
            position: relative;
        }

        /* Background decoration matching asam-basa */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 118, 117, 0.15) 0%, transparent 50%);
            z-index: -1;
        }

        .app {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 14px;
            padding: 12px;
            min-height: 100vh;
            height: auto;
        }

        aside {
            display: block;
        }

        @media (max-width:900px) {
            .app {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
                padding: 8px;
                height: auto;
                min-height: 100vh;
            }

            /* HIDE LEFT PANEL (ASIDE.LEFT) ON MOBILE */
            aside.left {
                display: none !important;
            }

            /* KEEP RIGHT PANEL VISIBLE */
            aside.right {
                display: flex;
                order: 2;
            }

            .workspace {
                order: 1;
            }

            .tray {
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                touch-action: pan-y !important;
            }

            .tray .tool {
                touch-action: auto !important;
                pointer-events: auto;
            }
        }

        button {
            background-color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            border-radius: 4px;
        }

        button:hover {
            background-color: #e0e0e0;
        }

        #selesaiBtn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        #selesaiBtn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .panel {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--glass-border);
            min-height: 80px;
            height: fit-content;
            align-self: start;
        }

        .panel h3 {
            margin: 0 0 1rem 0;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-dark);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .left {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: calc(100vh - 24px);
            overflow-y: auto;
        }

        .tools {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .tool {
            background: rgba(102, 126, 234, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            cursor: grab;
            user-select: none;
            touch-action: none;
            transition: transform 0.2s ease;
            will-change: transform;
        }

        .tool:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .tool:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        .tool .label {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .tool .name {
            font-weight: 700;
            margin-top: 6px;
            font-size: 14px;
            color: var(--text-dark);
        }

        .workspace {
            position: relative;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            height: 95vh;
            overflow-y: auto;
        }

        .lab-area {
            width: 100%;
            height: 100%;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--glass-border);
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        @media (max-width:900px) {
            .lab-area {
                height: 100%;
                min-height: 400px;
            }
        }

        .bench {
            flex: 0 0 80%;
            position: relative;
            border-radius: 12px;
            padding: 12px;
            overflow: hidden;
            min-height: 400px;
            border: 1px solid var(--glass-border);
            z-index: 1;
        }

        /* Background dengan blur */
        .bench::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08)),
                url('./assets/images/BG-Lab.png');
            background-size: cover;
            background-position: center;
            filter: blur(3px);
            z-index: -1;
            transform: scale(1.1);
        }

        @media (max-width:900px) {
            .bench {
                height: 100%;
                min-height: 400px;
                overflow-y: auto;
            }
        }

        .lab-pretest {
            flex: 0 0 20%;
            background: rgba(102, 126, 234, 0.05);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            overflow-y: auto;
            min-height: 150px;
        }

        .lab-pretest-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px dashed rgba(102, 126, 234, 0.3);
        }

        .lab-pretest-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-purple);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lab-pretest-badge {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .lab-question-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 12px;
            display: flex;
            gap: 12px;
        }

        .lab-question-image {
            flex: 0 0 20%;
            min-width: 80px;
            max-width: 150px;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(102, 126, 234, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .lab-question-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .lab-question-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .lab-question-text {
            color: var(--text-dark);
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .lab-question-context {
            background: rgba(96, 165, 250, 0.1);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #60a5fa;
            font-size: 12px;
            line-height: 1.5;
            color: var(--text-dark);
            margin-top: 8px;
        }

        .lab-pretest::-webkit-scrollbar {
            width: 6px;
        }

        .lab-pretest::-webkit-scrollbar-track {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 3px;
        }

        .lab-pretest::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            border-radius: 3px;
        }

        @media (max-width:900px) {
            .lab-question-card {
                flex-direction: column;
            }

            .lab-question-image {
                flex: 0 0 auto;
                width: 100%;
                max-width: 100%;
                height: 150px;
            }

            .lab-area {
                flex-direction: column;
            }

            .bench {
                flex: 0 0 70%;
                min-height: 350px;
            }

            .lab-pretest {
                flex: 0 0 30%;
                min-height: 200px;
            }

            .lab-question-text {
                font-size: 12px;
            }

            .lab-question-context {
                font-size: 11px;
            }
        }

        /* Scene Area - where the filtration happens */
        .scene-container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        @media (max-width:900px) {
            .scene-container {
                flex-direction: column;
                gap: 20px;
            }
        }

        .water-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .glass {
            width: 100px;
            height: 160px;
            border-radius: 8px;
            border: 3px solid #475569;
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 12px 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .glass-label {
            font-size: 11px;
            font-weight: 700;
            color: #334155;
            margin-bottom: 8px;
            z-index: 2;
        }

        .water {
            width: 100%;
            flex: 1;
            border-radius: 4px;
            background: rgba(120, 72, 0, 0.7);
            transition: background 900ms ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .glass-hint {
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
            max-width: 120px;
        }

        #airBersih_hasil.clean .water {
            background: linear-gradient(180deg, rgba(96, 165, 250, 0.3) 0%, rgba(147, 197, 253, 0.5) 100%);
        }

        /* Filtration Bottle */
        #botolFiltrasi {
            width: 200px;
            height: 380px;
            border: 4px solid #78350f;
            border-radius: 12px;
            position: relative;
            background: linear-gradient(180deg, #ffffff 0%, #fef3c7 100%);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            padding: 16px 12px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            pointer-events: none;
        }

        #botolFiltrasi:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        #botolFiltrasi.over {
            border-color: var(--primary-purple);
            background: linear-gradient(180deg, #e0f2fe 0%, #fef3c7 100%);
        }

        .bottle-label {
            font-weight: 700;
            color: #78350f;
            font-size: 13px;
            text-align: center;
            margin-bottom: 12px;
        }

        .layer-list {
            flex: 1;
            display: flex;
            flex-direction: column-reverse;
            gap: 8px;
            overflow: auto;
            padding: 4px;
        }

        .layer {
            min-height: 50px;
            border-radius: 8px;
            border: 2px dashed rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: #1e293b;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .layer:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: #ef4444;
        }

        .drop-hint {
            font-size: 11px;
            color: #92400e;
            text-align: center;
            margin-top: 8px;
            opacity: 0.7;
        }

        .pouring {
            position: absolute;
            left: 50%;
            top: 60px;
            transform: translateX(-50%);
            width: 20px;
            height: 150px;
            pointer-events: none;
            display: none;
            z-index: 10;
        }

        .stream {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(139, 90, 43, 0.8), rgba(107, 63, 32, 0.6));
            border-radius: 10px;
            animation: drop 1600ms ease-out forwards;
        }

        @keyframes drop {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            80% {
                transform: translateY(250px);
                opacity: 0.8;
            }

            100% {
                transform: translateY(300px);
                opacity: 0;
            }
        }

        .tray-toggle {
            position: absolute;
            right: 12px;
            top: 12px;
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0.8rem 1.2rem;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 9999;
        }

        .tray-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
        }

        .tray {
            position: absolute;
            right: 12px;
            top: 60px;
            display: none;
            flex-direction: column;
            gap: 8px;
            width: 220px;
            max-height: 400px;
            overflow-y: auto;
            background: var(--glass-bg);
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--glass-border);
            z-index: 1000;
        }

        .tray.open {
            display: flex;
            z-index: 1000;
        }

        .tray::-webkit-scrollbar {
            width: 6px;
        }

        .tray::-webkit-scrollbar-track {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 3px;
        }

        .tray::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            border-radius: 3px;
        }

        .right {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: calc(100vh - 24px);
            overflow-y: auto;
        }

        .left::-webkit-scrollbar,
        .right::-webkit-scrollbar {
            width: 6px;
        }

        .left::-webkit-scrollbar-track,
        .right::-webkit-scrollbar-track {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 3px;
        }

        .left::-webkit-scrollbar-thumb,
        .right::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            border-radius: 3px;
        }

        .btn {
            display: inline-block;
            padding: 12px 16px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            color: white;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn-outline {
            background: white;
            color: var(--primary-purple);
            border: 2px solid var(--glass-border);
        }

        .btn-outline:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .floating {
            position: fixed;
            z-index: 1000;
        }

        .tool-ghost {
            opacity: 0.9;
            transform: translate(-50%, -50%);
            pointer-events: none;
            will-change: transform, left, top;
        }

        @keyframes ripple {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            }

            50% {
                box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
            }
        }

        strong {
            color: var(--primary-purple);
            font-weight: 700;
        }

        .instruction-text {
            font-size: 13px;
            color: var(--text-muted);
            line-height: 1.6;
            background: rgba(102, 126, 234, 0.05);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            margin-top: 8px;
        }

        /* Preloader styles */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loader p {
            margin-top: 1rem;
            font-size: 1.2rem;
            color: white;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ===== POST TEST POPUP STYLES ===== */
        .post-test-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 10000;
            overflow-y: auto;
            padding: 20px;
        }

        .post-test-popup.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .post-test-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            animation: slideUp 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .post-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 28px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .post-test-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-purple);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .close-btn {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: rotate(90deg);
        }

        .post-test-body {
            padding: 24px 28px;
            overflow-y: auto;
            max-height: calc(90vh - 180px);
        }

        .post-test-body::-webkit-scrollbar {
            width: 8px;
        }

        .post-test-body::-webkit-scrollbar-track {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 4px;
        }

        .post-test-body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            border-radius: 4px;
        }

        .test-intro {
            background: rgba(96, 165, 250, 0.1);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid #60a5fa;
            margin-bottom: 24px;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .question-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .question-number {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .question-tag {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-purple);
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 13px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .question-context {
            background: rgba(255, 255, 255, 0.8);
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 14px;
            line-height: 1.6;
            color: var(--text-dark);
            font-size: 14px;
            border-left: 3px solid rgba(102, 126, 234, 0.5);
        }

        .question-text {
            color: var(--text-dark);
            line-height: 1.7;
            font-size: 14px;
        }

        .question-text p {
            margin-bottom: 10px;
        }

        .question-text ol {
            margin-left: 20px;
            margin-top: 8px;
            line-height: 1.8;
        }

        .question-text ol li {
            margin-bottom: 10px;
            padding-left: 8px;
        }

        .post-test-footer {
            padding: 20px 28px;
            border-top: 2px solid rgba(102, 126, 234, 0.2);
            display: flex;
            justify-content: center;
            background: rgba(255, 255, 255, 0.5);
        }

        .close-test-btn {
            padding: 14px 40px;
            font-size: 16px;
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .close-test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* Mobile responsive */
        @media (max-width: 900px) {
            .post-test-popup {
                padding: 10px;
            }

            .post-test-content {
                max-height: 95vh;
            }

            .post-test-header {
                padding: 16px 20px;
            }

            .post-test-header h2 {
                font-size: 18px;
            }

            .post-test-body {
                padding: 16px 20px;
                max-height: calc(95vh - 160px);
            }

            .question-card {
                padding: 16px;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .question-text ol {
                margin-left: 16px;
            }

            .scene-container {
                flex-direction: column;
                gap: 20px;
            }

            #botolFiltrasi {
                width: 180px;
                height: 320px;
            }

            .glass {
                width: 90px;
                height: 140px;
            }
        }
    </style>
</head>

<body>
    <div class="loader">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>
    <div class="app">
        <aside class="panel left">
            <h3 style="margin:0 0 12px 0">üî¨ Palet Alat & Bahan</h3>
            <div class="tools" id="tools">
                <!-- tools will be generated by JS -->
            </div>
            <div style="margin-top:8px; font-size:13px; color:var(--muted); line-height:1.4">
                <strong>Petunjuk:</strong> Seret bahan filtrasi ke botol untuk menyusun lapisan. Di mobile, tap area lab
                untuk quick menu.
            </div>
        </aside>
        <main class="panel workspace">
            <div class="lab-area" id="lab">
                <div class="bench" id="bench">
                    <div class="scene-container">
                        <div class="water-container">
                            <div id="airKotor" class="glass" title="Air Kotor">
                                <div class="glass-label">üíß AIR KOTOR</div>
                                <div class="water"></div>
                            </div>
                            <div class="glass-hint">Sumber air mentah</div>
                        </div>

                        <div style="position: relative;">
                            <div id="botolFiltrasi" aria-label="Botol Filtrasi">
                                <div class="bottle-label">üß™ BOTOL FILTRASI</div>
                                <div class="layer-list" id="layerList"></div>
                                <div class="drop-hint">(Tarik bahan ke sini)</div>
                                <div class="pouring" id="pouring">
                                    <div class="stream"></div>
                                </div>
                            </div>
                        </div>

                        <div class="water-container">
                            <div id="airBersih_hasil" class="glass" title="Hasil" aria-live="polite">
                                <div class="glass-label">‚ú® AIR HASIL</div>
                                <div class="water"></div>
                            </div>
                            <div class="glass-hint">Hasil filtrasi</div>
                        </div>
                    </div>

                    <button class="tray-toggle" id="trayToggle">üî¨ Alat & Bahan</button>
                    <div class="tray" id="tray"></div>
                </div>

                <!-- PRE-TEST SOAL DI LAB AREA -->
                <div class="lab-pretest">
                    <div class="lab-pretest-header">
                        <div class="lab-pretest-title">
                            üìù Studi Kasus
                        </div>
                        <span class="lab-pretest-badge">Redoks & Filtrasi</span>
                    </div>

                    <div class="lab-question-card">
                        <div class="lab-question-image">
                            <img src="./assets/images/air-keruh.jpg" alt="Ilustrasi Air Keruh"
                                onerror="this.style.display='none'">
                        </div>

                        <div class="lab-question-content">
                            <div class="lab-question-text">
                                <strong>Pertanyaan:</strong><br>
                                Sebuah desa di pedesaan memiliki sumber air dari sungai yang keruh dan mengandung
                                banyak zat organik. Warga ingin membuat filter sederhana menggunakan bahan lokal
                                (kerikil, pasir, arang aktif, ijuk, dan tawas). Bagaimana urutan penyusunan bahan
                                yang paling efektif untuk menjernihkan air, dan mengapa arang aktif penting dalam
                                proses ini?
                            </div>

                            <div class="lab-question-context">
                                üí° <strong>Petunjuk:</strong> Pikirkan tentang proses fisik (penyaringan) dan kimia
                                (adsorpsi, reduksi-oksidasi) yang terjadi di setiap lapisan. Pertimbangkan urutan dari
                                lapisan paling kasar hingga paling halus.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="panel right">
            <button onclick="window.location.href='./start-praktikum.html'">Kembali</button>
            <button id="selesaiBtn">Selesai</button>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px">
                <h3 style="margin:0">üìä Kontrol</h3>
                <button id="resetBtn" class="btn" style="padding:6px 12px; font-size:13px">üîÑ Reset</button>
            </div>

            <button class="btn" id="tombolMulaiFilter" style="width:100%; padding:14px;">
                üöÄ Mulai Filtrasi
            </button>

            <div style="margin-top:10px">
                <strong>üí° Tips Urutan Ideal</strong>
                <div
                    style="font-size:12px; color:var(--muted); margin-top:8px; line-height:1.6; background:rgba(102,126,234,0.05); padding:12px; border-radius:8px; border:1px solid var(--glass-border)">
                    Kerikil ‚Üí Pasir ‚Üí Arang Aktif ‚Üí Ijuk ‚Üí Tawas
                    <br><br>
                    <span style="font-size:11px; opacity:0.8">Lapisan kasar di bawah, halus di atas untuk hasil
                        optimal.</span>
                </div>
            </div>

            <div style="margin-top:10px">
                <strong>üî¨ Bahan & Fungsi</strong>
                <div
                    style="font-size:11px; color:var(--muted); margin-top:8px; line-height:1.5; background:rgba(255,255,255,0.5); padding:10px; border-radius:8px; border:1px solid var(--glass-border)">
                    <div style="margin-bottom:6px"><strong>ü™® Kerikil:</strong> Lapisan pelindung & penyaring kasar
                    </div>
                    <div style="margin-bottom:6px"><strong>üèñÔ∏è Pasir:</strong> Menyaring partikel halus</div>
                    <div style="margin-bottom:6px"><strong>‚ö´ Arang Aktif:</strong> Adsorpsi & redoks kontaminan</div>
                    <div style="margin-bottom:6px"><strong>üåæ Ijuk:</strong> Filtrasi fisik tambahan</div>
                    <div style="margin-bottom:6px"><strong>üíé Tawas:</strong> Koagulasi partikel tersuspensi</div>
                </div>
            </div>
        </aside>

        <!-- POST TEST POPUP -->
        <div id="postTestPopup" class="post-test-popup">
            <div class="post-test-content">
                <div class="post-test-header">
                    <h2>üìã Post Test - Evaluasi Praktikum</h2>
                    <button id="closePostTest" class="close-btn">‚úï</button>
                </div>

                <div class="post-test-body" id="postTestBody">
                    <div class="test-intro">
                        <p style="margin-bottom: 16px; color: var(--text-muted); line-height: 1.6;">
                            Selamat! Anda telah menyelesaikan praktikum virtual filtrasi air dan redoks. Berikut adalah
                            5 soal analisis untuk menguji pemahaman Anda tentang proses penjernihan air dan reaksi
                            redoks.
                        </p>
                    </div>

                    <!-- Soal 1 -->
                    <div class="question-card">
                        <div class="question-header">
                            <span class="question-number">Soal 1</span>
                            <span class="question-tag">Urutan Lapisan Filter</span>
                        </div>
                        <div class="question-context">
                            Dalam praktikum, Anda menyusun lapisan filter dengan urutan: Kerikil ‚Üí Pasir ‚Üí Arang Aktif
                            ‚Üí Ijuk ‚Üí Tawas. Setiap lapisan memiliki fungsi spesifik dalam menjernihkan air.
                        </div>
                        <div class="question-text">
                            <p><strong>Pertanyaan:</strong></p>
                            <ol>
                                <li>Mengapa kerikil diletakkan paling bawah dalam botol filtrasi? Jelaskan fungsinya
                                    dalam proses penjernihan air.</li>
                                <li>Analisis apa yang akan terjadi jika urutan lapisan dibalik (tawas di bawah,
                                    kerikil di atas)? Apakah filtrasi tetap efektif?</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Soal 2 -->
                    <div class="question-card">
                        <div class="question-header">
                            <span class="question-number">Soal 2</span>
                            <span class="question-tag">Peran Arang Aktif dalam Redoks</span>
                        </div>
                        <div class="question-context">
                            Arang aktif (karbon aktif) merupakan komponen kunci dalam sistem filtrasi modern. Selain
                            adsorpsi fisik, arang aktif juga berperan dalam reaksi redoks.
                        </div>
                        <div class="question-text">
                            <p><strong>Pertanyaan:</strong></p>
                            <ol>
                                <li>Jelaskan mekanisme adsorpsi yang terjadi pada permukaan arang aktif. Mengapa
                                    arang aktif efektif menghilangkan bau dan warna dari air?</li>
                                <li>Bagaimana arang aktif dapat membantu mereduksi ion logam berat dalam air? Jelaskan
                                    dengan konsep reaksi redoks!</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Soal 3 -->
                    <div class="question-card">
                        <div class="question-header">
                            <span class="question-number">Soal 3</span>
                            <span class="question-tag">Fungsi Tawas dalam Koagulasi</span>
                        </div>
                        <div class="question-context">
                            Tawas (Al‚ÇÇ(SO‚ÇÑ)‚ÇÉ) adalah koagulan yang umum digunakan dalam pengolahan air. Ketika
                            ditambahkan ke air, tawas bereaksi dan membentuk flok yang mengendapkan partikel
                            tersuspensi.
                        </div>
                        <div class="question-text">
                            <p><strong>Pertanyaan:</strong></p>
                            <ol>
                                <li>Jelaskan proses kimia yang terjadi ketika tawas ditambahkan ke dalam air keruh.
                                    Apa peran ion Al¬≥‚Å∫ dalam koagulasi?</li>
                                <li>Mengapa tawas ditempatkan di lapisan paling atas dalam filter? Analisis hubungannya
                                    dengan proses pengendapan partikel!</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Soal 4 -->
                    <div class="question-card">
                        <div class="question-header">
                            <span class="question-number">Soal 4</span>
                            <span class="question-tag">Reaksi Redoks dalam Filtrasi</span>
                        </div>
                        <div class="question-context">
                            Dalam sistem filtrasi alami, berbagai reaksi redoks terjadi terutama pada lapisan arang
                            aktif dan dalam interaksi dengan zat organik serta logam terlarut.
                        </div>
                        <div class="question-text">
                            <p><strong>Pertanyaan:</strong></p>
                            <ol>
                                <li>Identifikasi contoh reaksi redoks yang mungkin terjadi ketika air yang mengandung
                                    Fe¬≤‚Å∫ (besi terlarut) melewati lapisan arang aktif.</li>
                                <li>Bagaimana oksigen terlarut dalam air berperan dalam reaksi redoks selama proses
                                    filtrasi? Jelaskan dengan persamaan reaksi sederhana!</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Soal 5 -->
                    <div class="question-card">
                        <div class="question-header">
                            <span class="question-number">Soal 5</span>
                            <span class="question-tag">Aplikasi dalam Kehidupan</span>
                        </div>
                        <div class="question-context">
                            Sistem filtrasi sederhana seperti yang dipraktikkan dapat diterapkan di daerah terpencil
                            yang tidak memiliki akses ke air bersih. Namun, ada beberapa keterbatasan yang perlu
                            diperhatikan.
                        </div>
                        <div class="question-text">
                            <p><strong>Pertanyaan:</strong></p>
                            <ol>
                                <li>Analisis kelebihan dan kekurangan sistem filtrasi sederhana ini jika diterapkan
                                    dalam skala rumah tangga di desa.</li>
                                <li>Bagaimana cara meningkatkan efektivitas filter sederhana ini? Berikan minimal 3
                                    saran perbaikan berdasarkan prinsip kimia dan fisika yang telah dipelajari!</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div class="post-test-footer">
                    <button id="closePostTestBtn" class="btn close-test-btn">
                        ‚úì Selesai Membaca
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Items data for filtration materials
        const itemsData = [
            { id: 'kerikil', name: 'Kerikil', type: 'material', desc: 'Pelindung', color: '#94a3b8' },
            { id: 'pasir', name: 'Pasir', type: 'material', desc: 'Penjerap', color: '#fbbf24' },
            { id: 'arang_aktif', name: 'Arang Aktif', type: 'material', desc: 'Adsorben/Redoks', color: '#1e293b' },
            { id: 'ijuk', name: 'Ijuk/Kasa', type: 'material', desc: 'Filtrasi Fisik', color: '#78350f' },
            { id: 'tawas', name: 'Tawas', type: 'material', desc: 'Koagulan', color: '#e0f2fe' },
        ];

        const toolsContainer = document.getElementById('tools');
        const bench = document.getElementById('bench');
        const botol = document.getElementById('botolFiltrasi');
        const layerList = document.getElementById('layerList');
        const tray = document.getElementById('tray');
        const trayToggle = document.getElementById('trayToggle');
        const resetBtn = document.getElementById('resetBtn');
        const tombolMulaiFilter = document.getElementById('tombolMulaiFilter');
        const pouring = document.getElementById('pouring');
        const airKotor = document.querySelector('#airKotor .water');
        const airHasil = document.getElementById('airBersih_hasil');

        const correctOrder = ['kerikil', 'pasir', 'arang_aktif', 'ijuk', 'tawas'];
        let chosenOrder = [];

        function createToolCard(item) {
            const el = document.createElement('div');
            el.className = 'tool';
            el.dataset.id = item.id;
            el.tabIndex = 0;
            el.setAttribute('role', 'button');
            el.setAttribute('aria-label', `${item.name} - ${item.desc}`);

            el.innerHTML = `
            <div style="height:46px; display:flex; align-items:center; justify-content:center">
                ${getIconSVG(item)}
            </div>
            <div class="name">${item.name}</div>
            <div class="label">${item.desc}</div>
        `;

            makeDraggable(el, item);
            return el;
        }

        function getIconSVG(item) {
            return `<svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="8" fill="${item.color}" fill-opacity="0.95" stroke="rgba(0,0,0,0.2)" stroke-width="2"/>
        </svg>`;
        }

        // Populate tools
        itemsData.forEach(it => {
            const node = createToolCard(it);
            toolsContainer.appendChild(node);
        });

        // Add quick items to tray
        itemsData.forEach(it => {
            const node = document.createElement('div');
            node.className = 'tool';
            node.style.width = '100%';
            node.style.display = 'flex';
            node.style.alignItems = 'center';
            node.style.justifyContent = 'space-between';
            node.style.padding = '8px';
            node.style.cursor = 'pointer';

            node.innerHTML = `
            <div style="display:flex; align-items:center; gap:8px; flex:1">
                <div style="width:28px;height:20px;border-radius:6px;background:${it.color}; box-shadow:0 2px 6px rgba(0,0,0,0.3)"></div>
                <div style="flex:1">
                    <div style="font-weight:600; font-size:13px">${it.name}</div>
                    <div style="font-size:11px;color:var(--muted)">${it.desc}</div>
                </div>
            </div>
            <button class="btn" style="padding:4px 10px; font-size:12px; margin-left:8px">+</button>
        `;

            node.addEventListener('click', () => addToBottle(it));
            node.querySelector('.btn').addEventListener('click', (e) => {
                e.stopPropagation();
                addToBottle(it);
            });

            tray.appendChild(node);
        });

        // Toggle tray
        trayToggle.addEventListener('click', () => {
            tray.classList.toggle('open');
        });

        // Make draggable
        function makeDraggable(domNode, item) {
            let ghost = null;
            let dragging = false;

            function start(ev) {
                if (window.innerWidth <= 900 && domNode.closest('.tray')) {
                    return;
                }
                ev.preventDefault();
                ev.stopPropagation();
                dragging = true;

                const clientX = ev.clientX !== undefined ? ev.clientX : ev.touches?.[0]?.clientX;
                const clientY = ev.clientY !== undefined ? ev.clientY : ev.touches?.[0]?.clientY;

                ghost = domNode.cloneNode(true);
                ghost.classList.add('floating', 'tool-ghost');
                ghost.style.position = 'fixed';
                ghost.style.left = clientX + 'px';
                ghost.style.top = clientY + 'px';
                ghost.style.width = Math.max(80, domNode.offsetWidth) + 'px';
                ghost.style.pointerEvents = 'none';
                ghost.style.zIndex = '1000';
                document.body.appendChild(ghost);

                document.addEventListener('pointermove', move, { passive: false });
                document.addEventListener('pointerup', end);
                document.addEventListener('touchmove', move, { passive: false });
                document.addEventListener('touchend', end);
            }

            function move(ev) {
                if (!dragging) return;
                ev.preventDefault();

                const clientX = ev.clientX !== undefined ? ev.clientX : ev.touches?.[0]?.clientX;
                const clientY = ev.clientY !== undefined ? ev.clientY : ev.touches?.[0]?.clientY;

                ghost.style.left = clientX + 'px';
                ghost.style.top = clientY + 'px';

                const ghostRect = ghost.getBoundingClientRect();
                const ghostCenterX = ghostRect.left + ghostRect.width / 2;
                const ghostCenterY = ghostRect.top + ghostRect.height / 2;

                const botolRect = botol.getBoundingClientRect();
                const isOver = ghostCenterX >= botolRect.left &&
                    ghostCenterX <= botolRect.right &&
                    ghostCenterY >= botolRect.top &&
                    ghostCenterY <= botolRect.bottom;

                if (isOver) {
                    ghost.style.transform = 'translate(-50%,-50%) scale(1.12)';
                    botol.classList.add('over');
                } else {
                    ghost.style.transform = 'translate(-50%,-50%) scale(1)';
                    botol.classList.remove('over');
                }
            }

            function end(ev) {
                if (!dragging) return;
                dragging = false;

                document.removeEventListener('pointermove', move);
                document.removeEventListener('pointerup', end);
                document.removeEventListener('touchmove', move);
                document.removeEventListener('touchend', end);

                if (ghost) {
                    const ghostRect = ghost.getBoundingClientRect();
                    const ghostCenterX = ghostRect.left + ghostRect.width / 2;
                    const ghostCenterY = ghostRect.top + ghostRect.height / 2;

                    const botolRect = botol.getBoundingClientRect();
                    const isOver = ghostCenterX >= botolRect.left &&
                        ghostCenterX <= botolRect.right &&
                        ghostCenterY >= botolRect.top &&
                        ghostCenterY <= botolRect.bottom;

                    if (isOver) {
                        addToBottle(item);
                    }

                    botol.classList.remove('over');
                    ghost.remove();
                    ghost = null;
                }
            }

            domNode.addEventListener('pointerdown', start);
            domNode.addEventListener('touchstart', start, { passive: false });
        }

        function addToBottle(item) {
            chosenOrder.push(item.id);
            const el = document.createElement('div');
            el.className = 'layer';
            el.dataset.type = item.id;
            el.textContent = item.name;
            el.title = 'Klik untuk menghapus layer ini';
            layerList.appendChild(el);
            flashMessage(`${item.name} ditambahkan!`);
        }

        // Remove layer by clicking
        layerList.addEventListener('click', e => {
            const l = e.target.closest('.layer');
            if (!l) return;
            const idx = Array.from(layerList.children).indexOf(l);
            if (idx > -1) {
                chosenOrder.splice(idx, 1);
                l.remove();
                flashMessage('Layer dihapus');
            }
        });

        // Start filtration
        tombolMulaiFilter.addEventListener('click', () => {
            if (chosenOrder.length === 0) {
                showSimpleModal('‚ö†Ô∏è Perhatian', 'Masukkan minimal satu bahan ke dalam botol untuk memulai filtrasi.');
                return;
            }

            pouring.style.display = 'block';

            setTimeout(() => {
                const hasArang = chosenOrder.includes('arang_aktif');
                const orderMatch = arraysEqual(chosenOrder, correctOrder);
                const isGood = hasArang && orderMatch;

                setTimeout(() => {
                    pouring.style.display = 'none';
                    if (isGood) {
                        airHasil.classList.add('clean');
                        airKotor.style.background = 'linear-gradient(180deg, rgba(96, 165, 250, 0.3), rgba(147, 197, 253, 0.5))';
                        showResult(true);
                    } else {
                        airHasil.classList.remove('clean');
                        showResult(false);
                    }
                }, 1500);
            }, 80);
        });

        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < b.length; i++) if (a[i] !== b[i]) return false;
            return true;
        }

        function showResult(ok) {
            const title = ok ? '‚úÖ Berhasil: Air menjadi lebih jernih' : '‚ö†Ô∏è Hasil terbatas: Air masih keruh';
            const para = ok
                ? 'Urutan dan bahan lengkap terpasang dengan benar! Arang aktif membantu adsorpsi kontaminan dan koagulan (tawas) membantu pengendapan partikel halus. Air hasil filtrasi tampak lebih jernih.'
                : 'Urutan salah atau bahan penting (seperti arang aktif) tidak ada. Beberapa kontaminan larut masih tersisa sehingga air tetap keruh. Coba urutkan ulang sesuai tips yang diberikan.';
            showSimpleModal(title, para);
        }

        function showSimpleModal(title, text) {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.inset = '0';
            modal.style.background = 'rgba(0,0,0,0.7)';
            modal.style.backdropFilter = 'blur(8px)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = '9999';
            modal.style.padding = '20px';

            const card = document.createElement('div');
            card.style.background = 'var(--glass-bg)';
            card.style.backdropFilter = 'blur(20px)';
            card.style.borderRadius = '16px';
            card.style.padding = '28px';
            card.style.maxWidth = '500px';
            card.style.boxShadow = '0 25px 50px -12px rgba(0,0,0,0.25)';
            card.style.border = '1px solid var(--glass-border)';

            card.innerHTML = `
            <h3 style="color:var(--primary-purple); margin-bottom:16px; font-size:20px">${title}</h3>
            <p style="font-size:14px; color:var(--text-dark); line-height:1.7; margin-bottom:20px">${text}</p>
            <div style="display:flex; justify-content:flex-end">
<button class="btn" style="padding:10px 20px">Tutup</button>
</div>
`;
            modal.appendChild(card);
            document.body.appendChild(modal);

            card.querySelector('.btn').addEventListener('click', () => modal.remove());
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        function flashMessage(text) {
            const f = document.createElement('div');
            f.style.position = 'fixed';
            f.style.left = '50%';
            f.style.top = '20%';
            f.style.transform = 'translateX(-50%) scale(0.8)';
            f.style.background = 'var(--glass-bg)';
            f.style.color = 'var(--text-dark)';
            f.style.backdropFilter = 'blur(10px)';
            f.style.padding = '16px 24px';
            f.style.borderRadius = '12px';
            f.style.zIndex = '9999';
            f.style.fontSize = '16px';
            f.style.fontWeight = '600';
            f.style.boxShadow = '0 8px 32px rgba(0,0,0,0.5)';
            f.style.border = '1px solid rgba(255,255,255,0.1)';
            f.style.transition = 'all 0.3s ease-out';
            f.innerText = text;
            document.body.appendChild(f);

            setTimeout(() => f.style.transform = 'translateX(-50%) scale(1)', 10);
            setTimeout(() => {
                f.style.opacity = '0';
                f.style.transform = 'translateX(-50%) scale(0.8)';
            }, 1500);
            setTimeout(() => f.remove(), 1800);
        }

        // Reset
        resetBtn.addEventListener('click', () => {
            if (chosenOrder.length > 0) {
                const confirmReset = document.createElement('div');
                confirmReset.style.position = 'fixed';
                confirmReset.style.left = '50%';
                confirmReset.style.top = '50%';
                confirmReset.style.transform = 'translate(-50%, -50%)';
                confirmReset.style.background = 'rgba(255, 255, 255, 0.98)';
                confirmReset.style.backdropFilter = 'blur(10px)';
                confirmReset.style.padding = '24px';
                confirmReset.style.borderRadius = '12px';
                confirmReset.style.border = '1px solid rgba(255,255,255,0.1)';
                confirmReset.style.boxShadow = '0 8px 32px rgba(0,0,0,0.5)';
                confirmReset.style.zIndex = '9999';
                confirmReset.style.textAlign = 'center';
                confirmReset.style.maxWidth = '300px';

                confirmReset.innerHTML = `
                <div style="font-size:18px;font-weight:700;margin-bottom:12px;color:var(--text-dark)">Reset Filter?</div>
                <div style="color:var(--text-muted);margin-bottom:20px;font-size:14px">Semua lapisan akan dihapus dan filter dikembalikan ke kondisi awal</div>
                <div style="display:flex;gap:10px;justify-content:center">
                    <button id="cancelReset" style="padding:10px 20px;border-radius:8px;background:rgba(102,126,234,0.1);border:1px solid rgba(102,126,234,0.2);color:var(--primary-purple);font-weight:600;cursor:pointer">Batal</button>
                    <button id="confirmReset" style="padding:10px 20px;border-radius:8px;background:linear-gradient(90deg,#ef4444,#dc2626);border:none;color:white;font-weight:600;cursor:pointer">Reset</button>
                </div>
            `;

                document.body.appendChild(confirmReset);

                document.getElementById('cancelReset').addEventListener('click', () => confirmReset.remove());
                document.getElementById('confirmReset').addEventListener('click', () => {
                    performReset();
                    confirmReset.remove();
                });
            } else {
                flashMessage('Filter sudah kosong!');
            }
        });

        function performReset() {
            chosenOrder = [];
            layerList.innerHTML = '';
            document.querySelector('#airBersih_hasil .water').style.background = 'rgba(120,72,0,0.7)';
            document.getElementById('airBersih_hasil').classList.remove('clean');
            document.querySelector('#airKotor .water').style.background = 'rgba(120,72,0,0.7)';
            flashMessage('‚úì Filter direset!');
        }

        // ===== POST TEST FUNCTIONALITY =====
        const postTestPopup = document.getElementById('postTestPopup');
        const selesaiBtn = document.getElementById('selesaiBtn');
        const closePostTest = document.getElementById('closePostTest');
        const closePostTestBtn = document.getElementById('closePostTestBtn');

        selesaiBtn.addEventListener('click', () => {
            postTestPopup.classList.add('active');
            document.body.style.overflow = 'hidden';
            flashMessage('üìã Silakan baca soal Post Test');
        });

        closePostTest.addEventListener('click', () => {
            postTestPopup.classList.remove('active');
            document.body.style.overflow = 'auto';
        });

        closePostTestBtn.addEventListener('click', () => {
            postTestPopup.classList.remove('active');
            document.body.style.overflow = 'auto';
            flashMessage('‚úì Terima kasih telah membaca Post Test');
        });

        postTestPopup.addEventListener('click', (e) => {
            if (e.target === postTestPopup) {
                postTestPopup.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && postTestPopup.classList.contains('active')) {
                postTestPopup.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        // Hide preloader
        window.addEventListener('load', () => {
            const loader = document.querySelector('.loader');
            if (loader) loader.style.display = 'none';
            flashMessage('üî¨ Virtual Lab siap digunakan!');
        });

        // Keyboard accessibility
        document.querySelectorAll('.tool').forEach(t => {
            t.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const id = t.dataset.id;
                    const it = itemsData.find(x => x.id === id);
                    if (it) {
                        t.style.transform = 'scale(0.95)';
                        setTimeout(() => t.style.transform = 'scale(1)', 100);
                        addToBottle(it);
                    }
                }
            });

            t.addEventListener('focus', () => t.style.outline = '2px solid #60a5fa');
            t.addEventListener('blur', () => t.style.outline = 'none');
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/edulab/service-worker.js', {
                    scope: '/edulab/'
                })
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>